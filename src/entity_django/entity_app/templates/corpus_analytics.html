<!DOCTYPE html>
{% load static %}
<link rel="stylesheet" href="{% static 'styles.css' %}">
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href='https://fonts.googleapis.com/css?family=KoHo' rel='stylesheet'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>

    <title>Sensitivity Detection Tool</title>
</head>
<body>

<div class="topnav">
    <a class="title" href="">Sensitivity Detection Tool</a>
    <a href="/home">Home</a>
    <a href="/view_document/">Documents</a>
    <a href="/view_entity">Entities</a>
    <a class="active" href="/corpus_analytics/">Analytics</a>

    <a style="width:200px; margin-left: 120px;" href="/user_study/"><div style="border-radius: 10px; background-image: linear-gradient(to top, #7b8fb0, #7b8fb0); padding: 2px 0px 2px 0px;">User Study</div></a>

    <a href="/upload_document/" class="upload" style="float: right;">Upload Files<i class="material-icons">upload</i></a>
</div>

<div class="main">
    <h1 style="display: inline;">Topic Modelling</h1>
    <a class="doc-analyse-link"  style="display: inline; float: right;" href="/regenerate_lda/" onclick="return confirm('Are you sure? This may be a time consuming process.')">
        <button class="document-button-icon" style="padding: 7px 10px 7px 10px;">
            <i class="material-icons" style="font-size:15px;">restart_alt</i>Regenerate Topics
        </button>
    </a>
    <br>


    {% for topic, topic_title in topics %}
        {% if not forloop.counter|divisibleby:2 %}
        <div class="wrapper-analytics">
            <canvas id="{{forloop.counter}}" style="width: 450px; float: left; padding-right: 20px;"></canvas>

            <script>
            var xValues{{forloop.counter|safe}} = {{topic.3|safe}};
            var yValues = {{topic.1|safe}};
            var barColors = {{topic.2|safe}};
            var slugs{{forloop.counter|safe}} = {{topic.4|safe}};

            function graphClickEvent(event, array) {
                var firstPoint = this.getElementAtEvent(event)[0];
                if (firstPoint) {
                    let index = xValues{{forloop.counter}}.indexOf(firstPoint._model.label);
                    window.location.href='/view_entity/'+slugs{{forloop.counter|safe}}[index];
                }
            }

            new Chart("{{forloop.counter}}", {
              type: "doughnut",
              data: {
                labels: xValues{{forloop.counter}},
                datasets: [{
                  backgroundColor: barColors,
                  data: yValues,
                }]
              },
              options: {
                onClick: graphClickEvent,
                legend: {
                    display: false,
                },
                responsive: false,
                title: {
                  display: true,
                  text: "Distribution of Topic: {{topic_title|safe}}"
                }
              },
              plugins: []
            });
            </script>
            <div style="padding: 100px 0px 0px 40px;">

                {% for label in topic.3 %}
                   <p style="word-wrap: break-word; font-weight: bold;">{{label}}</p>
                {% endfor %}
            </div>
        </div>

        {% else %}
        <div class="wrapper-analytics">
            <h2 style="padding: 0px; margin: 0px; padding-bottom: 5px;">Related Documents:</h2>
            <table style="width: 100%; border-collapse: collapse;">
                {% for topic_doc in topic %}
                <tr style="border-radius: 5px; border-top: 1pt solid #DFDFDF;">
                    <td>
                        <div onclick="window.location.href='/view_document/{{ent_doc.documentID}}/'" style="padding: 0px 2px 0px 2px;">{{topic_doc.documentID.filetitle}}</div>
                    </td>

                    <td style="float:right; padding-right: 0px;">
                    <a href="/delete_document/{{ent_doc.documentID}}/" onclick="return confirm('Are you sure?')">
                        <button class="document-button-icon">
                            <i class="material-icons" style="font-size:15px;">delete</i>
                        </button>
                    </a>
                    </td>

                    <td style="float:right;">
                    <a href="/view_document/{{ent_doc.documentID}}/">
                        <button class="document-button-icon">
                            <i class="material-icons" style="font-size:15px;">search</i>
                        </button>
                    </a>
                    </td>

                </tr>

                {% endfor %}
            </table>


        </div>
        {% endif %}

    {% endfor %}

</div>

</body>
</html>
